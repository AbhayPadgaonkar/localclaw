services:
  # This is YOUR Wizard App
  manager:
    build: .
    ports:
      - "3000:3000"
    volumes:
      # CRITICAL: Grants "God Mode" over Docker to spawn agents
      - /var/run/docker.sock:/var/run/docker.sock
      # Persistent storage for all spawned agents
      - ./agents:/app/agents
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      # ðŸŸ¢ UPDATE THIS: Use host.docker.internal instead of localhost
      # ðŸŸ¢ CRITICAL: Tells Ollama to accept browser requests from your app

      - DATABASE_URL=postgresql://postgres:abhay306560@host.docker.internal:5432/localclaw
      - SERVER_IP=localhost
      - OPENCLAW_GATEWAY_TOKEN=localclaw_master_token
      - NEXT_PUBLIC_RAZORPAY_KEY_ID=${NEXT_PUBLIC_RAZORPAY_KEY_ID}
      - RAZORPAY_KEY_SECRET=${RAZORPAY_KEY_SECRET}
      - EMAIL_USER=${EMAIL_USER}
      - EMAIL_PASS=${EMAIL_PASS}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
      - NEXTAUTH_URL=http://localhost:3000
      - AUTH_SECRET=${NEXTAUTH_SECRET}
      - AUTH_GOOGLE_ID=${AUTH_GOOGLE_ID}
      - AUTH_GOOGLE_SECRET=${AUTH_GOOGLE_SECRET}
      - AUTH_TRUST_HOST=true
    restart: always

  # Optional: A shared Ollama instance
  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]


volumes:
  ollama_data: